<div class="map-page">

  <!-- Overlay header sits on top of the map -->
  <header class="map-header">
    <h1>Mobility Map – Montréal &amp; Laval</h1>
    <div class="legend">
      <span class="legend-item bixi">
        <span class="dot"></span> BIXI Station
      </span>
      <span class="legend-item parking">
        <span class="dot"></span> Parking
      </span>
    </div>
  </header>

  @if (locations$ | async; as result) {
    @if (result.error) {
      <div class="state-message error">{{ result.error }}</div>
    } @else if (result.data) {
      <google-map
        [center]="center"
        [zoom]="zoom"
        [options]="mapOptions"
        width="100%"
        height="100%"
      >
        @for (loc of result.data; track loc.placeId) {
          <map-marker
            #marker="mapMarker"
            [position]="getMarkerPosition(loc)"
            [options]="getMarkerOptions(loc)"
            (mapClick)="openInfo(infoWindow, marker, loc)"
          />
        }

        <map-info-window #infoWindow="mapInfoWindow">
          @if (selectedLocation) {
            <div class="info-window">
              <strong>{{ selectedLocation.name }}</strong>
              <span class="type-badge" [class]="selectedLocation.type">
                {{ selectedLocation.type === 'bixi' ? '🚲 BIXI' : '🅿️ Parking' }}
              </span>
              @if (selectedLocation.vicinity) {
                <p class="vicinity">{{ selectedLocation.vicinity }}</p>
              }
              @if (selectedLocation.availableSpots != null) {
                <p class="spots" [class.low]="selectedLocation.availableSpots <= 5">
                  🅿️ <strong>{{ selectedLocation.availableSpots }}</strong> spots available
                </p>
              }
            </div>
          }
        </map-info-window>
      </google-map>
    }
  } @else {
    <div class="state-message">Loading locations…</div>
  }

</div>


